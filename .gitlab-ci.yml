stages:
  - generate-source
  - build
  - deploy

generate-sources:
  stage: generate-source
  image: python:3.8
  script:
    - pip install -r src/requirements.txt
    - python src/main.py resume
    - python src/main.py resume-simple
  artifacts:
    paths:
      - dist/

generate-resumes:
  stage: build
  image: blang/latex:ubuntu
  script:
    - cp archive/mcdowellcv.cls dist
    - cd dist
    - lualatex resume.tex
    - lualatex resume-simple.tex
  artifacts:
    paths:
      - dist/resume.pdf
      - dist/resume-simple.pdf
  dependencies:
    - generate-sources

deploy:
  stage: deploy
  only:
    refs:
      - master
  script:
    - apt-get update -qq && apt-get install -y -qq sshpass
    - sshpass -e scp -o stricthostkeychecking=no dist/*.pdf sh3292@tux.cs.drexel.edu:~/public_html/
